# 03. Amazon Q CLI 고급 기능

### 🧩 01. Model Context Protocol (MCP)란?

MCP는 AI 애플리케이션이 외부 도구 및 데이터 소스에 표준화된 방식으로 연결되도록 해주는 프로토콜입니다.

AI 버전의 USB-C와 유사하다고 이해하면 됩니다.

***

#### ✅ MCP의 구성 요소

<table data-header-hidden><thead><tr><th width="255.9375"></th><th></th></tr></thead><tbody><tr><td>구성 요소</td><td>설명</td></tr><tr><td>MCP Host</td><td>Amazon Q CLI와 같은 AI 애플리케이션 자체</td></tr><tr><td>MCP Client</td><td>Host 내부에서 동작하며 MCP Server와 통신</td></tr><tr><td>MCP Server</td><td>특정 기능을 수행하는 실행 파일 또는 라이브러리 (대부분 로컬에서 실행됨)</td></tr></tbody></table>

#### ⚙️ MCP Server 실행 방식

| 방식              | 설명                                   |
| --------------- | ------------------------------------ |
| Native 실행       | 로컬 환경에 직접 라이브러리 설치 및 실행              |
| Container 기반 실행 | 종속성이 복잡하거나 충돌 가능성이 있을 경우 컨테이너 사용이 유리 |

{% hint style="info" %}
MCP Server는 보안상 위험 요소도 될 수 있으므로 신뢰된 소스만 설치하고 실행해야 합니다.
{% endhint %}

***

#### 🔐 MCP 보안 모델 핵심

* 명시적 권한 부여: MCP Tool 사용 전 명시적으로 ‘t’를 눌러 허용
* 로컬 실행 및 격리: 각 MCP Server는 개별 프로세스로 로컬에서 격리 실행
* 가시성 확보: 어떤 Tool이 어떤 행동을 하는지 명확히 표시

***

#### 🧪 Task 1 – Promptz MCP Server 추가 실습 

#### ✅ 1. MCP 설정 파일 생성

```
cd ~/.aws/amazonq
nano mcp.json
```

다음 내용 입력:

```
{
  "mcpServers": {
    "promptz.dev/mcp": {
      "command": "npx",
      "args": [
        "-y",
        "@promptz/mcp"
      ],
      "env": {
        "PROMPTZ_API_URL": "https://retdttpq2ngorbx7f5ht4cr3du.appsync-api.eu-central-1.amazonaws.com/graphql",
        "PROMPTZ_API_KEY": "da2-45yiufdo5rcflbas7rzd3twble"
      },
      "disabled": false,
      "autoApprove": []
    }
  }
}
```

#### ✅ 2. 상태 확인

```
q mcp status --name promptz.dev/mcp
```

출력 예시:

```
Scope   : 🌍 global
File    : /Users/yourname/.aws/amazonq/mcp.json
Command : npx
Env Vars: PROMPTZ_API_URL, PROMPTZ_API_KEY
```

주의: MCP Server에 따라 추가적으로 python, uv 등이 필요할 수 있습니다.

***

#### ✅ 3. Q CLI 실행 및 MCP 서버 로딩 확인

```
q
```

시작 시 출력 (잠깐 뜹니다):

```
✓ promptzdevmcp loaded in 1.29 s
✓ 1 of 1 mcp servers initialized
```

***

#### ✅ 4. MCP 서버 사용 테스트

```
새로운 Flask 앱을 생성해줘. 프롬프트는 Promptz에서 가져와 사용해줘.
```

Amazon Q 응답 예:

```
I'll help you create a new Flask application. Let me check for available prompts from promptz.dev
```

MCP Server에서 tool 호출 시 \[y/n/t] 로 확인 요청됩니다.

* t 입력하여 해당 Tool을 세션 내 신뢰(trust)

***

#### ✅ 5. MCP 도구 목록 확인

```
/tools
```

예시 출력:

```
Tool                                Permission
...
promptzdevmcp___list_prompts        trusted
promptzdevmcp___get_prompt          not trusted
```

→ MCP Server를 통해 추가된 tool들은 명시적으로 trust를 해야 실행 가능

***

#### 📌 참고

* MCP 전역 설정 파일: \~/.aws/amazonq/mcp.json
* MCP 프로젝트별 설정: 프로젝트 경로/.amazonq/mcp.json
* MCP 관리 명령어:

```
q mcp list
q mcp add/remove/import
q mcp status --name [서버명]
```



이 문서는 MCP(Memory Context Protocol) Prompts의 활용법을 설명하며, Amazon Q CLI와 함께 사용하는 MCP 서버를 어떻게 구성하고, 해당 서버에서 제공하는 Prompt 리소스를 어떻게 호출할 수 있는지를 보여줍니다. 아래는 핵심 내용을 정리한 번역입니다.

***

### 🧩 01. Model Context Protocol (MCP) dp

\


MCP 서버는 다음과 같은 세 가지 유형의 리소스를 제공합니다:

1. Tools
   * AI 코딩 어시스턴트가 호출할 수 있는 함수 정의
   * 가장 일반적이며, 명령 실행 목적
2. Resources
   * 서버와 클라이언트 간의 상태 데이터 공유 (예: 설정 파일, 동적 사용자 데이터, 이미지 등)
3. Prompts
   * 일관된 사용자 프롬프트 템플릿을 생성해 재사용 가능하게 함
   * Amazon Q CLI에서는 /prompts 명령어를 통해 사용 가능

***

#### 🧪 실습: MCP Prompt 서버 만들기

1. 새 터미널을 열고 작업 디렉터리 생성:

```
mkdir -p ~/projects/mcp-prompts
cd ~/projects/mcp-prompts
```

1. \

2. mcp-server.py 파일 생성 후 아래 코드 추가:

```
import asyncio
import sys
from crawl4ai import *
from mcp.server.fastmcp import Context, FastMCP

mcp = FastMCP("ContextScraper")

@mcp.tool()
async def crawl(url: str, ctx: Context) -> str:
    dev_null = open("/dev/null", "w")
    sys.stdout = dev_null
    async with AsyncWebCrawler() as crawler:
        result = await crawler.arun(url=url)
        return result.markdown

@mcp.prompt()
def create_context_from_url(url: str) -> str:
    return f'Use the crawl tool to crawl url={url}. Write the webpage content to a markdown file in ".amazonq/rules/" of the current directory.'

@mcp.prompt()
def create_new_project() -> str:
    return f'Create a new project layout. Create a top level src directory, and in the src directory create subdirectories for templates, models, routes, and static. Add a README.md to the src directory.'
```

2. \

3. 가상 환경 및 종속성 설치:

```
python -m venv .mcp
source .mcp/bin/activate
pip install mcp crawl4ai "mcp[cli]"
```

3. \

4. .amazonq/mcp.json 구성 생성:

```
mkdir .amazonq
touch .amazonq/mcp.json
```

4. 내용:

```
{
    "mcpServers": {
        "ContextScraper": {
            "command": "uv",
            "args": ["run", "--with", "mcp", "mcp", "run", "mcp-server.py"]
        }
    }
}
```

4. \

5. 디렉터리 구조:

```
mcp-prompts/
├── .mcp/
├── .amazonq/
│   └── mcp.json
└── mcp-server.py
```

\


***

#### ✅ Amazon Q CLI에서 MCP Prompt 사용

1. Amazon Q CLI 세션 시작 후, 다음 입력:

```
/prompts list
```

1. \

2. 출력 예시:

```
Prompt                    Arguments (* = required)
context_scraper (MCP):
- create_context_from_url url*
- create_new_project
```

2. \

3. 프롬프트 실행 예시:

```
@create_new_project
```

3. → 프로젝트 디렉터리 및 README 생성
4. URL 기반 컨텍스트 추가 예시:

```
@create_context_from_url url=https://blog.beachgeek.co.uk/mcp-finch/
```

4. → 웹페이지 내용을 크롤링하여 .amazonq/rules/에 마크다운 파일로 저장됨
5. 추가된 컨텍스트 확인:

```
/context show
```

\


***

#### 💡 요약

* MCP Prompt를 통해 반복 가능한 명령 템플릿을 만들 수 있음
* 사용자 상호작용을 단순화하고 일관되게 구성 가능
* @{prompt} 형식으로 프롬프트 호출 가능
* AI 어시스턴트를 위한 워크플로우 자동화에 유용

***

필요하시다면 이 실습을 위한 워크숍 문서나 Notion 양식으로도 정리해 드릴 수 있습니다.

###

