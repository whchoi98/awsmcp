# 04. Amazon Q CLI 기능 (NEW)

## 🧩 Amazon Q CLI 기능

이 랩에서는 **Amazon Q CLI**의 기능들을 살펴봅니다.

***

## 🧩 명령어 자동 완성 (Command Line Completion)

명령어 자동 완성 기능은 Amazon Q CLI를 전체 설치했을 경우에만 사용할 수 있습니다. 이 기능은 자주 사용하는 명령어에 대해 다양한 옵션을 제시해주는 도우미 역할을 합니다. 예를 들어, AWS CLI, Docker, Git 등의 명령어 입력 시 보조 기능을 제공합니다.

터미널에서 명령어를 입력하면, 이제 어떤 명령어 옵션을 사용할지에 대한 추천이 표시됩니다.

* ↑, ↓ 키로 옵션 탐색 가능
* 입력을 계속하면 옵션이 자동으로 필터링됨
* ESC 키를 누르면 추천 옵션 창을 종료할 수 있음

### 🧪 Task-01

1. 터미널을 열고 `git` 입력 후 스페이스를 누르세요. 어떤 일이 일어나는지 확인해보세요.
2. ↑, ↓ 키로 항목을 탐색하고 ENTER 키로 선택
3. `git push`까지 입력한 후 스페이스를 누르면, 관련 옵션이 더 좁혀짐
4. `docker`, `java`, `dotnet` 명령어 등도 시도해보세요.
5. ESC 키로 메뉴를 종료하고 계속 입력할 수 있습니다.

***

## 🧩  명령어 자동 제안 (Command Line Auto Suggestion)

Amazon Q CLI는 단순한 보조 기능을 넘어, 사용자가 입력한 내용을 분석해 문맥에 맞는 명령어를 제안합니다.

***

## 🧩  명령어 번역 (Command Line Translation)

CLI 툴을 사용할 때 필요한 다양한 매개변수를 자주 잊어버리곤 합니다. 이제는 `--help`를 사용하는 대신, **명령어 번역** 기능을 통해 원하는 작업을 자연어로 설명하면 Amazon Q CLI가 이를 명령어로 변환해 줍니다.

사용 방법:

```
q ai "하고자 하는 작업 설명"
q translate "의도"
```

🔍 예시 출력 :

```

 q ai "list all my aws account"   
  Translate English to Shell commands. Run in any shell.
  Shell · aws sts get-caller-identity --query Account --output text
❯ ⚡ Execute command
  📝 Edit command
  🔄 Regenerate answer
  ❓ Ask another question
  ❌ Cancel
```

### 🧪 Task-02

터미널에서 다음을 입력하세요:

```bash
q ai “이 디렉터리 및 모든 하위 디렉터리에서 가장 큰 파일 3개를 찾아줘.”
```

* ↑, ↓ 키로 선택 가능
* ENTER 키로 실행
* `Edit`를 선택해 명령어 수정 후 실행 가능
* `Regenerate`로 다른 제안 요청 가능

몇 초 후 다음과 같은 결과가 나타납니다:

```bash
$ q ai “이 디렉터리 및 모든 하위 디렉터리에서 가장 큰 파일 3개를 찾아줘.”  

  Shell · find . -type f -printf '%s %p\n' | sort -rn | head -3

190390228 ./q.zip
113574768 ./q/bin/qchat
113574768 ./.local/bin/qchat
```

***

## 🧩  인터랙티브 채팅 (Interactive / Agentic Chat)

지금까지 Amazon Q CLI를 명령 실행을 도와주는 단순한 도구(tool)로 사용해왔습니다.

하지만 Amazon Q Developer CLI는 대화형(chat) 모드를 지원하며, 이 모드를 통해 터미널 환경 내에서 자연어로 질문하고, 대화하며, 다양한 작업을 수행할 수 있습니다.

#### ⚙️ 채팅 모드 진입 방법

터미널에서 다음 명령어 중 하나를 입력하면 채팅 모드로 진입할 수 있습니다:

* 단순 실행:

```
q
```

* 또는

```
q chat
```

#### ⚙️ 세션 시작 시 로드되는 설정

Amazon Q CLI가 채팅 세션을 시작할 때는 다음과 같은 설정 파일들을 로드합니다:

**✅ 글로벌 설정 (Global Configurations)**

* `q settings` 명령으로 정의한 설정값들이 포함된 `settings.json` 파일을 로드합니다.

**✅ 세션 설정 (Session Configuration)**

* 이 파트에서 사용될 Custom Agent(사용자 정의 에이전트) 설정을 로드합니다.
* 여기에는 다음과 같은 항목들이 포함될 수 있습니다:
  * MCP 서버 설정
  * 컨텍스트 리소스(Context Resources)
  * 도구 권한(Tool Permissions)

### 💻  Amazon Q CLI의 사용자 정의 에이전트 (Custom Agents)

Amazon Q CLI 버전 v1.13.1부터, 챗 세션을 시작할 때 자동으로 Custom Agent 설정을 로드합니다.

* Custom Agent는 도구, 리소스, 컨텍스트 등을 정의할 수 있는 설정 저장소(configuration repository)입니다.
* 아무런 인자를 주지 않고 q chat을 실행하면, 기본 에이전트인 `q_cli_default`가 로드됩니다.\


⚙️  **특정 Custom Agent 사용 예시**

예를 들어, php-dev라는 Custom Agent를 만들었다면 아래와 같이 실행할 수 있습니다:

```
q chat --agent php-dev
```

***

### 🧪 Task-03

터미널에서 다음 명령어 중 하나를 입력해 Amazon Q CLI 채팅 화면으로 진입합니다:

```
q
```

또는

```
q chat
```

터미널에 다음을 입력합니다:

```
“당신은 탭(tabs)과 스페이스(spaces) 중 무엇을 선호하나요?” 한글로 답변해줘
```

Amazon Q는 여기에 대해 유쾌한 답변을 줄 것입니다.

Amazon Q CLI는 AWS 관련 작업에만 제한되지 않으며, 다양한 일반 개발 작업에도 활용할 수 있습니다.

몇 초 후 다음과 같은 결과가 나타납니다:

```
> 저는 스페이스(spaces)를 추천합니다. 이유는 다음과 같습니다:

• **환경 간 일관성** - 모든 에디터, 터미널, 브라우저에서 동일하게 보입니다
• **업계 표준** - 대부분의 스타일 가이드(Python PEP 8, Google, Airbnb)에서 스페이스를 권장합니다
• **도구 호환성** - 코드 포매터, 린터, diff 도구에서 더 나은 지원을 제공합니다
• **혼합 들여쓰기 문제 방지** - 탭과 스페이스가 섞이는 흔한 문제를 없앨 수 있습니다

특히 Python의 경우 PEP 8에서 들여쓰기 레벨당 4개의 스페이스를 의무화하고 있습니다. 대부분의 최신 에디터는 Tab 키를 눌렀을 때 스페이스를 삽입하도록 설정할 수 있어서 두 방식
의 장점을 모두 얻을 수 있습니다.

중요한 것은 프로젝트와 팀 내에서의 일관성입니다 - 어떤 것을 선택하든 코드베이스 전체에서 일관되게 사용하는 것이 핵심입니다.
```

\
도움말이 필요하다면, 다음 명령어로 확인할 수 있습니다:

```
/help
```

⚙️  **현재 로드된 Custom Agent 확인**

다음 명령어를 입력해 확인할 수 있습니다:

```
/agent list
```

예시 출력:

```
> /agent list

* q_cli_default
```

현재 기본 에이전트 q\_cli\_default가 사용되고 있음을 확인할 수 있습니다.

⚙️  **종료 방법**

Amazon Q CLI 세션을 종료하려면:

* 다음 명령어 입력:

```
/q
```

* 또는 키보드에서 CTRL + C 입력

***

### 🧪 Task-04

Amazon Q CLI는 단순히 응답만 하는 도구가 아니라, 에이전트(agentic)로 작동합니다.

즉, 입력된 프롬프트를 작업(Task)으로 분해하고, 이를 순차적으로 실행해나갑니다.

작업 수행 중에는 `Thinking...` 메시지가 출력되며, 사용자의 확인 또는 추가 입력이 필요할 경우에는 적절히 안내합니다.

#### ⚙️  실습: Dockerfile 생성 요청

1. 터미널에서 Amazon Q CLI를 실행합니다:

```
q
```

2. 프롬프트에 다음을 입력합니다:

```
어떠한 파일도 생성하지 말고, 최신 버전의 Python을 사용하는 Python Flask 애플리케이션을 실행하기 위한 최적화된 Dockerfile을 보여줘.
```

몇 초 후 다음과 같은 결과가 나타납니다:

```
> 최신 Python을 사용하는 최적화된 Flask Dockerfile입니다:

dockerfile
FROM python:3.12-slim

WORKDIR /app

RUN adduser --disabled-password --gecos '' appuser

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .
RUN chown -R appuser:appuser /app

USER appuser

EXPOSE 5000

CMD ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "4", "app:app"]


주요 최적화 포인트:

• **python:3.12-slim** - 최신 버전 + 작은 이미지 크기
• **--no-cache-dir** - pip 캐시 제거로 이미지 크기 감소
• **비root 사용자** - 보안 강화
• **gunicorn** - 프로덕션용 WSGI 서버 (Flask 개발 서버보다 성능 우수)
• **멀티 워커** - 동시 요청 처리 능력 향상

requirements.txt에 gunicorn 추가 필요:
Flask==2.3.3
gunicorn==21.2.0


개발 환경에서는 CMD ["python", "app.py"]를 사용해도 됩니다.
```

***

### 🧩 도구 권한 (Tools & Permissions)

이전 프롬프트에서 `“어떠한 파일도 생성하지 말고”` 라는 문구를 의도적으로 넣은 이유는, Amazon Q CLI에게 단순히 보여주기만 하도록 요청했기 때문입니다. 하지만 Amazon Q CLI는 그 이상의 능력을 가지고 있습니다.

Amazon Q CLI에는 `“Tools(도구)”`라는 개념이 있으며, 이를 통해 외부 환경과 상호작용할 수 있습니다.

이와 동시에, 사용자가 도구 사용에 대한 제어권(control)을 가질 수 있도록, “도구 권한(Permissions)”이라는 개념도 함께 존재합니다.

도구는 다음 두 가지 상태로 설정됩니다:

* Trusted (신뢰됨)
* Untrusted (신뢰되지 않음)

즉, Amazon Q CLI가 어떤 Tool을 사용하려고 할 때, 그 Tool이 `“Untrusted”` 상태라면, 실행 여부에 대해 사용자의 허락을 요청하게 됩니다.

이때 사용자는 다음 중 하나를 선택할 수 있습니다:

* 이번 한 번만 허용
* 앞으로 항상 허용
* 거부

기본적으로, Amazon Q CLI는 읽기(Read) 작업만 수행하는 내장 도구(Built-In Tool)에 대해서는 자동으로 신뢰합니다.

그러나 파일 시스템에 쓰거나(Write), 명령어나 프로그램을 실행(execute)하는 도구는 기본적으로 신뢰하지 않도록 설정되어 있습니다.

왜 이게 중요할까요?

예를 들어, 사용자가 대규모 프로젝트에서 작업 중이라면, 여러 파일을 생성하거나 프로그램을 실행하는 일이 잦을 수 있습니다. 이때 모든 작업마다 도구 사용을 수동으로 허가해야 한다면 번거롭습니다.

따라서 도구의 신뢰 상태를 조정할 수 있는 제어 기능은, 필요한 상황에서는 자동으로 승인하도록 설정함으로써, 더 효율적인 작업을 가능하게 합니다.

도구 권한(Tools Permissions)을 살펴보고, 앞서 수행한 작업을 확장함으로써 이것이 실제로 어떻게 작동하는지 확인해봅니다.

Amazon Q CLI는 외부 환경과 상호작용할 수 있는 **도구(Tools)** 개념을 지원하며, 이들에 대해 신뢰 수준(Permission)을 설정할 수 있습니다.

기본적으로 **읽기 전용(Read-only)** 도구는 자동 신뢰, **쓰기**(Write)**/실행**(execute) 도구는 사용자의 확인 필요

⚙️ 도구 목록 보기:

```bash
/tools
```

출력 예시:

```
> /tools


Tool              Permission
▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔Built-in:
- execute_bash    * trust read-only commands
- fs_read         * trust working directory
- fs_write        * not trusted
- introspect      * trusted
- report_issue    * trusted
- use_aws         * trust read-only commands
```

### 🧪 Task-05

Amazon Q CLI에는 자동으로 신뢰되는 두 가지 도구(Tools)가 있습니다:

* `fs_read`: Amazon Q CLI가 로컬 파일 시스템의 파일을 읽을 수 있도록 허용합니다.
* `report_issue`: Amazon Q CLI를 사용하다가 발생한 문제를 GitHub 프로젝트 저장소에 이슈로 자동 생성할 수 있게 해줍니다.

반면, 다음과 같은 도구는 기본적으로 신뢰되지 않습니다:

* &#x20;파일을 작성(`fs_write`)하는 도구
* &#x20;파일을 실행(`execute_bash`)하는 도구

이 의미는 만약 Amazon Q CLI가 위 도구들을 사용하려고 시도하면, 사용자에게 실행 허가를 요청하는 프롬프트가 뜨게 된다는 뜻입니다.&#x20;

아래 프롬프트를 입력해보세요:

```bash
Python Flask 애플리케이션을 실행하기 위한 최적화된 Dockerfile을 생성해줘. 최신 버전의 Python을 사용해야 합니다.
```

* `fs_write` 도구 사용을 허용할지 묻는 메시지가 출력됩니다. `t`를 눌러 항상 신뢰 설정.

이전과 유사한 출력이 생성된 것을 확인할 수 있지만, 이번에는 fs\_write 도구를 신뢰할지 여부를 묻는 프롬프트가 나타납니다.

```
> Python Flask 애플리케이션을 실행하기 위한 최적화된 Dockerfile을 생성해줘. 최신 버전의 Python을 사용해야 합니다.

🛠️  Using tool: fs_write
 ⋮ 
 ● Path: /home/ec2-user/Dockerfile

+     1: FROM python:3.12-slim
+     2: 
+     3: WORKDIR /app
+     4: 
+     5: RUN adduser --disabled-password --gecos '' appuser
+     6: 
+     7: COPY requirements.txt .
+     8: RUN pip install --no-cache-dir -r requirements.txt
+     9: 
+    10: COPY . .
+    11: RUN chown -R appuser:appuser /app
+    12: 
+    13: USER appuser
+    14: 
+    15: EXPOSE 5000
+    16: 
+    17: CMD ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "4", "app:app"]

 ⋮ 
 ↳ Purpose: Create optimized Dockerfile for Python Flask application with latest Python version

Allow this action? Use 't' to trust (always allow) this tool for the session. [y/n/t]:
```

`fs_write` 는 파일을 작성(write) 할 때 사용되는 도구입니다.

여기서 선택할 수 있는 옵션은 다음과 같습니다:

* y → 이번 한 번만 허용
* n → 거부
* t → 항상 신뢰 (다음부터는 묻지 않음)

`"t"`를 입력하고 Enter 키를 누르면, Amazon Q CLI가 파일 생성을 완료하는 것을 볼 수 있습니다.

이와 함께 추가적인 파일들도 자동 생성될 수 있습니다.

이제 Amazon Q CLI를 종료하고, 생성된 파일들을 확인해보세요.

<pre><code><strong>cat Dockerfile 
</strong></code></pre>

Amazon Q CLI를 종료한 뒤 다시 실행하면, 도구 신뢰 설정은 기본값으로 초기화됩니다.

***

## 🧩 멀티라인 프롬프트 (Multi-line Prompts)

Amazon Q CLI 채팅에서 한 줄짜리 프롬프트(single line prompt)만 사용해보았지만, 실제로는 여러 가지 방법으로 여러 줄 프롬프트(multi-line prompt)를 입력할 수 있습니다.

입력 방식:

* `CTRL + J`: 새 줄 입력 : 터미널 내에서 여러 줄을 작성할 때 매우 유용합니다.
* `\`로 줄 끝에 붙이면 다음 줄로 이동 가능 : 이는 터미널에 익숙한 많은 사용자들이 가장 자연스럽게 사용하는 방식입니다.

### 🧪  Task-06

```
Python 코드를 작성할 때는 다음 지침을 따르세요:
- 웹 프레임워크로 Flask를 사용하세요.
- Flask의 애플리케이션 팩토리 패턴(Application Factory Pattern)을 따르세요.
- 구성(Configuration)에는 **환경 변수(Environment Variables)를 사용하세요.
- 데이터베이스 작업은 Flask-SQLAlchemy를 사용하여 구현하세요.
```

***

### 🧩 선호 편집기 설정 (Editor Configuration)

선호하는 어떤 에디터든 Amazon Q CLI에 간단한 설정만으로 연동할 수 있습니다.

환경 변수 설정:

```bash
export EDITOR=vim
```

#### 🧪 Task-07

```bash
/editor
```

편집기에서 멀티라인 프롬프트 작성 → 저장 후 종료 → 처리 시작

```
현재 계정정보를 알려줘.
서울 리전의 EC2 리스트도 알려줘.
```



***

## 🧩 이미지 사용 (Using Images in Prompt)

Amazon Q CLI는 프롬프트에 이미지를 포함하는 기능을 지원합니다.

프로젝트 작업 공간(workspace) 내의 이미지를 참조하여, Amazon Q CLI가 해당 이미지 기반으로 도움을 줄 수 있습니다.

예를 들어 다음과 같은 경우에 유용합니다:

* 아키텍처 다이어그램을 기반으로 인프라를 코드로 구현하고 싶을 때
* ERD(Entity Relationship Diagram)를 바탕으로 SQL 또는 데이터 모델을 생성하고자 할 때
* UI/디자인 시안을 참고하여 프로토타입 코드를 생성하고 싶을 때

이처럼 시각 자료를 기반으로 Amazon Q CLI가 작업을 이해하고 자동화할 수 있도록 돕습니다.

### 🧪 Task-08

1. `xxx.png` → `data-model` 디렉토리에 복사
2. 다음 명령 실행:

```bash
data-model 디렉토리에 있는 example-erd.png 다이어그램을 기반으로 Python으로 샘플 데이터 모델을 생성해줘.
```

Amazon Q CLI가 이미지 분석 후 코드 생성합니다.

***

## 🧩 모델 선택 및 변경 (Selecting the Large Language Model)

Amazon Q CLI에서는 채팅 세션 중 어떤 언어 모델(Language Model)을 사용할지 선택할 수 있습니다.

기본적으로 세션이 시작되면 기본 모델(default model)이 자동으로 설정되며, 원한다면 특정 세션 중간에 모델을 바꾸거나, 모든 세션에 적용할 기본 모델을 설정할 수도 있습니다.

#### ✅ 모델 선택 방법 두 가지

1. 채팅 세션 시작 시 지정

```
q chat --model <모델이름>
```

2. 채팅 세션 중에 /model 명령어 사용

* \> 프롬프트에서 `/model` 입력
* 방향키(↑ ↓)를 이용하여 원하는 모델 선택

#### ⚙️  2025년 6월 기준 사용 가능한 모델:

* claude-3.5-sonnet
* claude-3.7-sonnet
* claude-4-sonnet

#### ⚙️  주의: 모델 설정은 일시적입니다

* 세션을 종료하면 모델 설정은 기본값으로 되돌아갑니다.
* 기본 모델을 영구적으로 바꾸고 싶다면, settings 파일을 수정해야 합니다. (Advanced Setup에서 다룸)

### 🧪 Task-09 실습

* Amazon Q CLI 실행:

```
q

```

* 프롬프트에서 다음 명령 입력:

```
/model
```

* 원하는 모델로 변경하고, 다양한 프롬프트를 시도해보세요.
* 채팅 세션 종료 후, 다음 명령으로 새로운 모델을 지정한 채 세션 시작:

```
q chat --model claude-4-sonnet
```

* 다시 `/model` 입력해보면 Claude v4 모델이 선택된 상태임을 확인할 수 있습니다.
* 이제 세션을 종료하고 다시 Amazon Q CLI를 실행한 후 /model을 실행하면,

모델이 기본값으로 되돌아간 것을 확인할 수 있습니다.

이 과정을 통해 Amazon Q CLI에서 어떤 모델을 언제, 어떻게 사용하는지 유연하게 제어할 수 있게 됩니다.

***

## 🧩 Context Engineering (컨텍스트 엔지니어링)

Context(컨텍스트)는 Amazon Q CLI가 사용자가 입력한 프롬프트(prompt)와 함께 사용하여 출력(output)을 생성하는 데 활용하는 정보입니다. Amazon Q CLI를 사용할 때 컨텍스트를 어떻게 관리하느냐가 좋은 결과물을 얻는 데 핵심적입니다.

컨텍스트는 무한한 자원이 아니며, 효율적으로 관리되어야 합니다.

Amazon Q CLI가 출력 생성을 위해 사용하는 “컨텍스트 윈도우(context window)”는 유한한 자원이며,

이는 토큰(tokens)이라는 단위로 측정됩니다.

토큰은 대형 언어 모델(Large Language Models, LLMs)이 텍스트를 처리할 때 사용하는 기본 단위입니다.

현재 Amazon Q CLI의 최대 컨텍스트 윈도우 크기는 200,000 토큰입니다.

> Stanford University(스탠퍼드 대학교)\*\*의 연구에 따르면, 컨텍스트 길이가 길어질수록 오히려 출력 품질이 저하되는 경향이 있습니다.즉, 컨텍스트가 많다고 항상 좋은 것은 아니며,적절하게 필요한 정보만 포함하는 것이 더 중요합니다.

#### ✅ Amazon Q CLI에서의 Context 설정: 리소스(Resources)

Amazon Q CLI에서는 컨텍스트로 사용할 정보를 “리소스(Resources)”라는 개념으로 관리합니다.

이 리소스는 Markdown 파일(.md)이며, 사용자의 로컬 파일 시스템 내에 존재합니다.

Amazon Q CLI를 시작할 때, 에이전트 구성(agent configuration)을 참고하여 어떤 리소스를 컨텍스트로 불러올지를 결정합니다.

#### &#x20;✅ 기본 에이전트&#x20;

#### q\_cli\_default 의 자동 설정 리소스

<table data-header-hidden><thead><tr><th width="159.01873779296875"></th><th width="157.57183837890625"></th><th></th></tr></thead><tbody><tr><td>디렉토리 경로</td><td>파일 이름</td><td>설명</td></tr><tr><td>현재 디렉토리</td><td>README.md</td><td>Amazon Q CLI를 실행한 위치에서 README.md 파일을 찾습니다</td></tr><tr><td>현재 디렉토리</td><td>AmazonQ.md</td><td>동일하게 현재 디렉토리에서 AmazonQ.md 파일을 찾습니다</td></tr><tr><td>.amazonq/rules/</td><td>*.md</td><td>.amazonq/rules 디렉토리 아래의 모든 마크다운 파일을 포함합니다</td></tr></tbody></table>

#### 🛠️ 현재 적용된 Context 리소스 확인

Amazon Q CLI 채팅 세션 내에서 다음 명령어를 입력하면 현재 적용된 컨텍스트 리소스를 확인할 수 있습니다:

```
/context show
```

🔍 예시 출력 :

```
> /context show

👤 Agent (q_cli_default):
    AmazonQ.md 
    AGENTS.md 
    README.md 
    .amazonq/rules/**/*.md 

💬 Session (temporary):
    <none>

No files in the current directory matched the rules above.
```

이 출력에서는 현재 기본 에이전트(`q_cli_default`) 구성이 적용되었고,

다음과 같은 파일 패턴을 사용하고 있다는 것을 보여줍니다:

* .amazonq/rules/\*\*/\*.md
* README.md
* AmazonQ.md\


만약 프로젝트 워크스페이스에 이러한 파일이 존재한다면, Amazon Q CLI는 이를 읽고 컨텍스트로 자동 추가합니다. 그리고 해당 규칙에 일치한 파일 숫자가 표시됩니다.

### 🧪 Task-10

* Amazon Q CLI 채팅 세션을 엽니다.
* 프롬프트 >에서 다음 명령을 입력합니다:

```
/context show
```

이전에 실습을 진행하면서 README.md 파일이 생성되었다면, 해당 항목이 “Matched”로 표시될 것입니다.

* Amazon Q CLI를 종료합니다.

```
/quit
```

* 현재 디렉토리에 AmazonQ.md 또는 README.md 파일을 새로 생성하세요.

```
cat <<EOF > ~/AmazonQ.md
모든 답변은 한국어로 답변하세요.
EOF
```

* 다시 Amazon Q CLI를 실행하고, /context show 명령어를 다시 입력합니다.

```
/context show
```

이번에는 Amazon Q CLI가 새로 생성된 파일들을 인식하고, 해당 리소스를 컨텍스트에 포함(Matched)시켰다는 것을 확인할 수 있어야 합니다.

🔍 예시 출력 :

```
> /context show

👤 Agent (q_cli_default):
    AmazonQ.md (1 match)
    AGENTS.md 
    README.md 
    .amazonq/rules/**/*.md 

💬 Session (temporary):
    <none>

1 matched file in use:
👤 /home/ec2-user/AmazonQ.md (~10 tkns)

```

이처럼 Amazon Q CLI의 출력 품질을 높이기 위해서는, 컨텍스트로 어떤 정보가 사용되는지 명확히 관리하고, 필요에 맞게 구성하는 것이 매우 중요합니다.

***

## 🧩 컨텍스트에 리소스 추가 및 제거하기.

이전 실습에서 Amazon Q CLI 세션에 컨텍스트를 제공하는 “리소스(Resources)”에 대해 살펴보았습니다.

이제 해당 리소스를 직접 추가하거나 제거하면서, Amazon Q CLI가 어떤 정보를 참조할지를 더 정교하게 제어할 수 있습니다.

이를 위해 다음과 같은 명령어들을 사용할 수 있습니다:

* `/context add <파일명>` → 컨텍스트에 리소스 추가
* `/context remove <파일명>` 또는 `/context rm <파일명>` → 리소스 제거

***

### 🧪 Task-11 실습

* 현재 디렉토리에 새로운 파일을 생성합니다:

```
cat <<EOF > ~/project-standards.md
당신은 AWS 자원을 관리하는 시니어 솔루션즈 아키텍트입니다.
EOF
```

* 해당 파일을 컨텍스트에 추가합니다:

```
/context add project-standards.md
```

* 현재 컨텍스트 상태를 확인합니다:

```
/context show
```

🔍 예시 출력 :

```
/context show

👤 Agent (q_cli_default):
    AmazonQ.md (1 match)
    AGENTS.md 
    README.md 
    .amazonq/rules/**/*.md 

💬 Session (temporary):
    project-standards.md (1 match)

2 matched files in use:
💬 /home/ec2-user/project-standards.md (~20 tkns)
👤 /home/ec2-user/AmazonQ.md (~10 tkns)

Total: ~30 tokens
```

#### &#x20;⚙️ 리소스 제거

project-standards.md를 잘못 추가했거나 더 이상 필요하지 않다면, 다음 명령으로 제거할 수 있습니다:

```
/context rm project-standards.md
```

다시 /context show 명령을 실행하면 해당 항목이 더 이상 표시되지 않음을 확인할 수 있습니다.

```
/context show
```

🔍 예시 출력 :

```
> /context rm project-standards.md

Removed 1 path(s) from context.

Note: Context modifications via slash command is temporary.
```

#### ⚙️ 모든 컨텍스트 초기화 (주의 요망) 

Amazon Q CLI는 모든 컨텍스트 리소스를 한 번에 제거할 수 있는 명령도 제공합니다.

이 명령어는 현재 세션(Session) 동안 추가된 모든 컨텍스트 리소스를 한 번에 제거합니다.

{% hint style="info" %}
주의: 이 작업은 되돌릴 수 없으므로 신중히 사용해야 합니다.
{% endhint %}

```
/context clear
```

다시 /context show 명령을 실행하면 모든 항목이 더 이상 표시되지 않음을 확인할 수 있습니다.

```
/context show
```

🔍 예시 출력 :

```
> /context show

👤 Agent (q_cli_default):
    <none>

💬 Session (temporary):
    <none>

No files in the current directory matched the rules above.
```

이 명령은 현재 세션에 한해서만 적용되며, 세션을 종료하고 다시 시작하면 이전의 기본 리소스들은 자동으로 복구됩니다.

단, 이때 사용자 정의 에이전트(Custom Agent)에 명시된 리소스만 다시 불러와집니다.

Amazon Q CLI 세션을 종료합니다.

```
/quit
```

다시 /context show 명령을 실행하면 사용자 정의 에이전트(Custom Agent)에 명시된 리소스를 확인할 수 있습니다.

```
/context show
```

🔍 예시 출력 :

```
> /context show

👤 Agent (q_cli_default):
    AmazonQ.md (1 match)
    AGENTS.md 
    README.md 
    .amazonq/rules/**/*.md 

💬 Session (temporary):
    <none>

1 matched file in use:
👤 /home/ec2-user/AmazonQ.md (~10 tkns)

Total: ~10 tokens
```

***

### 🧩 컨텍스트 관리 (Context Management)

Amazon Q CLI는 최대 200,000 토큰(token)의 컨텍스트 윈도우(context window)를 제공합니다. 컨텍스트에 리소스를 추가할수록 이 토큰 용량을 점점 소모하게 되며, 이 한도를 초과하거나 가까워질 경우 출력 결과가 불안정해지거나 일관성이 떨어질 수 있습니다.

따라서 컨텍스트 사용량을 관리하는 것은 Amazon Q CLI를 일관적이고 효과적으로 사용하는 데 있어 매우 중요합니다.

#### 💻  Context 사용량 확인하기

현재 컨텍스트가 얼마나 사용되고 있는지를 확인하려면 다음 명령어를 입력하세요:

```
/usage
```

🔍 예시 출력 :

```
Current context window (2650 of 200k tokens used)
|████████████████████████████████████████████████████████████████████████████████ 1.32%

█ Context files: ~120 tokens (0.06%)
█ Tools:         ~2530 tokens (1.26%)
█ Q responses:   ~0 tokens (0.00%)
█ Your prompts:  ~0 tokens (0.00%)
```

#### &#x20;✅  사용 항목 설명

<table data-header-hidden><thead><tr><th width="155.1500244140625"></th><th></th></tr></thead><tbody><tr><td>항목</td><td>설명</td></tr><tr><td>Context files</td><td>사용자가 컨텍스트로 추가한 파일(예: .md 문서 등)형식의 리소스 파일들이 사용하는 토큰 수</td></tr><tr><td>Tools</td><td>현재 세션에 활성화된 도구(Tools)들이 사용하는 토큰 수</td></tr><tr><td>Q responses</td><td>Amazon Q가 이전에 생성한 응답들의 누적 토큰 수</td></tr><tr><td>Your prompts</td><td>사용자가 입력한 프롬프트의 누적 토큰 수</td></tr></tbody></table>

#### ⚠️ 왜 중요할까요?

* 200K 토큰 한도를 초과하면, 모델의 집중력이 분산되고 품질이 저하될 수 있습니다.
* 불필요한 리소스는 컨텍스트에서 제거하거나 요약하는 방식으로 관리할 수 있습니다.
*   /context show, /context rm, /context clear 명령어들과 함께 /usage 명령어를 자주 사용하면

    최적의 컨텍스트 상태를 유지할 수 있습니다.

***

### 🧪 Task-12 실습

* Amazon Q CLI 세션을 실행합니다:

```
q
```

* 프롬프트에서 다음 명령어를 입력하세요:

```
/usage
```

* 출력 내용을 살펴보며, 현재 어떤 요소들이 토큰을 사용 중인지, 얼마나 사용되고 있는지, 비효율적인 리소스는 없는지 등을 확인해보세요.

Amazon Q CLI의 컨텍스트 자원을 효과적으로 추적하고 관리하는 방법을 이해했습니다. 이것은 복잡한 프로젝트를 진행하거나 많은 리소스를 사용하는 경우 특히 중요합니다.

***

## 🧩 Compacting (컨텍스트 요약)

Amazon Q CLI의 컨텍스트 윈도우(context window) 사용량이 상한(200K 토큰) 에 근접하기 시작하면,

`“/compact”` 명령어를 통해 현재 컨텍스트를 요약(compact)하고, 토큰 사용량을 최적화할 수 있습니다.

이 기능은 모든 대화 이력과 참조 리소스를 요약한 요약본(summary)을 생성한 뒤, 기존 컨텍스트를 해당 요약으로 대체합니다. 이렇게 하면 사용된 토큰 수를 줄이면서도 주요 내용은 유지할 수 있게 됩니다.

#### ⚙️ Compacting 전후의 사용량 비교 예시

```
/usage
```

🔍 예시 출력 :

```
Current context window (50930 of 200k tokens used)
████████████████████████████████████████████████████████████████████████████████ 25.47%

█ Context files: ~10400 tokens (5.20%)
█ Tools:         ~2530 tokens (1.26%)
█ Q responses:   ~16730 tokens (8.36%)
█ Your prompts:  ~23800 tokens (11.90%)
```

⚙️ **압축 명령 실행:**&#x20;

```
/compact
```

```
✔ Conversation history has been compacted successfully!
```

이후 다시 /usage 실행 시:

```
Current context window (12060 of 200k tokens used)
████████████████████████████████████████████████████████████████████████████████ 6.03%

█ Context files: ~11470 tokens (5.73%)
█ Tools:         ~2530 tokens (1.26%)
█ Q responses:   ~580 tokens (0.29%)
█ Your prompts:  ~10 tokens (0.00%)
```

* 25% → 6% 수준으로 토큰 사용량이 대폭 감소한 것을 확인할 수 있습니다.

이 요약은 전체 작업 흐름의 중요한 맥락은 유지하면서도 불필요한 텍스트를 줄여줍니다.

#### ⚠️ Compact 안 되는 경우

컨텍스트가 너무 짧으면 다음과 같은 메시지가 표시됩니다:

```
> /compact

Conversation too short to compact.
```

***

#### ⚙️ 자동 Compact 제어하기

기본적으로 Amazon Q CLI는 컨텍스트 한도에 근접하면 자동으로 압축을 시도합니다.

하지만 이를 수동으로 관리하고 싶다면 아래 설정을 통해 자동 압축 기능을 끌 수 있습니다:

```
q settings chat.disableAutoCompaction true
```

이 설정 이후에는 자동으로 compact가 수행되지 않고, 사용자가 직접 /compact 명령을 통해 수동으로 실행해야 합니다.

***

### 🧪 Task-13 실습

* Amazon Q CLI 세션을 종료하세요.
* 현재 디렉토리에 다음 두 파일을 생성하세요:
  * AmazonQ.md (앞선 LAB에서 생성하였습니다.)
  * README.md

```
cat <<EOF > ~/README.md
모든 답변은 한국어로 답변하세요.
EOF
```

* Amazon Q CLI 세션을 다시 시작하세요:

```
q
```

* 다음과 같은 프롬프트를 입력해보세요:

```
AmazonQ.md 파일을 검토하고, 계획된 내용에 대한 요약을 제공해줘.
README.md 파일도 검토하고, 계획된 내용에 대한 요약을 제공해줘.
디자인을 검토하고, 개선사항을 제안해줘.
```

* 작업이 완료되면, 현재 컨텍스트 사용량 확인:

```
/usage
```

* 컨텍스트 요약 실행:

```
/compact
```

* 다시 컨텍스트 사용량 확인:

```
/usage
```

#### ✅  확인 포인트

* /compact 실행 전과 후의 토큰 수 비교
* 기존 대화 내용이 요약본으로 대체되었는지
* 중요한 맥락은 유지된 채, 사용량이 줄어들었는지

이 기능은 대규모 작업 세션이나 반복적인 대화 흐름을 관리할 때 매우 유용하며, 컨텍스트 한도를 효율적으로 유지하는 핵심 전략입니다.

***

## 🧩 Tangent Mode

새로운 실험적 기능(experimental feature)인 Tangent Mode(탄젠트 모드)를 소개합니다.

이 기능은 불필요하게 컨텍스트를 오염시키는(polluting) 상황을 최소화하면서도, 유용한 작업을 병행할 수 있는 능력을 제공합니다.

#### ⚙️  Tangent Mode란?

Amazon Q CLI 세션이 진행되다 보면, 주된 목표와 무관한 부가적인 작업을 해야 할 때가 있습니다.

예를 들어:

* 일시적으로 버그를 트러블슈팅(troubleshooting) 하거나
* 사소한 궁금증을 해결하거나
* 특정 기능에 대해 더 깊이 파고들어야 하는 경우\


이런 부가적인 대화(secondary interaction)는 주요 컨텍스트에 꼭 포함할 필요가 없을 수 있으며, 오히려 전체 대화 흐름을 방해할 수 있습니다.

Tangent Mode는 이러한 경우를 위해 “대화 체크포인트(conversation checkpoint)”를 생성하여,

본 흐름을 오염시키지 않고 분기 탐색을 가능하게 합니다.

***

### 🧪 Task-14

⚙️ **실험적 기능 활성화**

먼저, 다음 명령어로 실험 기능을 설정합니다:

```
/experiment
```

아래와 같은 메뉴가 나타나면, 방향키로 `“Tangent Mode”`에 이동 후 space 키를 눌러 활성화합니다:

```
? Select an experiment to toggle ›
  Knowledge         [ON]
  Thinking          [OFF]
❯ Tangent Mode      [OFF]  ← 여기서 Space 눌러서 [ON]으로 변경
  Todo Lists        [OFF]
```

활성화되면 아래 메시지가 출력됩니다:

```
Tangent Mode experiment enabled
```

* **Tangent 모드 진입**

```
/tangent
```

프롬프트가 아래처럼 변경됩니다:

```
> /tangent

Created a conversation checkpoint (↯). Use ctrl + t or /tangent to restore the conversation later.
Note: this functionality is experimental and may change or be removed in the future.

↯ > 
```

이제 본 대화를 보존한 채, 임시로 분기된 대화를 진행할 수 있습니다.

#### ✅  Tangent Mode 활용 예시

* 대안적 접근법(alternative approaches) 탐색
* Amazon Q CLI 기능 관련 도움말 요청
* 설계나 개념에 대한 명확성 검토(clarification)\


이때 수행되는 작업은 본 컨텍스트에 포함되지 않습니다.

#### ⚠️ Tangent이 활성화되지 않았을 경우

```
/tangent
```

실행 시 다음과 같은 메시지가 출력된다면:

```
Tangent mode is disabled. Enable it with: q settings chat.enableTangentMode true
```

아래 명령어로 수동 설정할 수 있습니다:

```
q settings chat.enableTangentMode true
```

#### ✅ Tangent 모드에서 대화 복원하기

```
↯ > /tangent
```

출력 예시:

```
Restored conversation from checkpoint (↯). - Returned to main conversation.
```

이제 프롬프트는 다시 일반 >로 바뀌고, 본 대화를 이어갈 수 있습니다.

#### 🔁 Tangent 대화를 본 대화에  포함시키고 싶다면?

Amazon Q CLI v1.16부터는, 분기된 대화를 본 컨텍스트에 병합할 수 있습니다.

Tangent 모드에서 대화를 마친 후 아래 명령어를 사용합니다:

```
↯ > /tangent tail
```

결과:

```
Restored conversation from checkpoint (↯) with last conversation entry preserved.
```

이제 본 대화에서 이전 tangent 대화를 기억하게 됩니다.

***

### 🧪 Task-15 실습

* Amazon Q CLI를 종료한 후 다시 시작합니다.

아래 명령어로 tangent 모드 진입:

```
/tangent
```

프롬프트에서 다음 질문 입력:

```
Python의 FastAPI에 대해 설명해줘
```

응답을 확인한 후, 다음 명령 실행:

```
/tangent
```

본 대화로 돌아왔을 때, 다음 질문 입력:

```
우리가 방금까지 무슨 이야기를 하고 있었지?
```

🔍 예시 출력 :

```
> 방금까지 AmazonQ.md와 README.md 파일들에 대한 검토와 개선 방안을 논의하고 있었습니다.

구체적으로:

• 파일 내용 확인: 두 파일 모두 "모든 답변은 한국어로 답변하세요"라는 언어 설정 지시만 포함되어 있었음
• 문제점 식별: 실제 프로젝트 내용이나 계획이 전혀 없는 상태
• 개선 제안: 
  • AmazonQ.md에는 프로젝트 개요, 기술 스택, 구현 계획, API 설계 등의 구조 제안
  • README.md에는 설치 방법, 사용법, 기여 가이드, 라이선스 등의 구조 제안

현재 프로젝트가 초기 계획 단계에 있으며, 문서화 작업이 시급한 상황으로 파악되었습니다.
```

* tangent 모드에서 진행된 대화는 기억되지 않음을 확인할 수 있습니다.

#### 다시 반복하되 /tangent tail  사용해보기

* 다시 /tangent로 진입

같은 질문:

```
Python의 FastAPI에 대해 설명해줘
```

/tangent tail 명령어 실행:

```
/tangent tail
```

본 대화로 돌아와 다시 질문:

```
우리가 방금까지 무슨 이야기를 하고 있었지?
```

🔍 예시 출력 :

```
> 우리가 방금까지 무슨 이야기를 하고 있었지?
> 방금 전에는 Python의 FastAPI에 대해 설명해드렸습니다.
FastAPI의 주요 특징(고성능, 자동 문서화, 타입 힌트, 비동기 지원), 기본 사용법 코드 예제, 실행 방법, 그리고 다른 프레임워크 대비 장점들을 다뤘습니다.
그 이전에는 AmazonQ.md와 README.md 파일들의 검토와 개선 방안에 대해 논의했었고요 - 두 파일 모두 실제 프로젝트 내용 없이 한국어 답변 지시만 있어서 구조적 개선이 필요하다는 
내용이었습니다.

```

* 이번에는 tangent 대화가 본 컨텍스트에 성공적으로 병합된 것을 확인할 수 있습니다.

#### ✅ 요약

<table data-header-hidden><thead><tr><th width="218.2874755859375"></th><th></th></tr></thead><tbody><tr><td>기능</td><td>설명</td></tr><tr><td>/tangent</td><td>현재 대화 흐름을 보존한 채 분기 대화로 진입</td></tr><tr><td>/tangent (다시 입력)</td><td>본 대화로 복귀</td></tr><tr><td>/tangent tail</td><td>마지막 tangent 대화를 본 대화에 병합</td></tr><tr><td>실험적 기능 설정</td><td>/experiment 또는 q settings chat.enableTangentMode true</td></tr></tbody></table>

Tangent Mode는 컨텍스트를 오염시키지 않고도 실험적이고 보조적인 작업을 수행할 수 있게 해주는 강력한 기능입니다.

***

## 🧩  Clearing (컨텍스트 초기화)

때때로 Amazon Q CLI 세션에서 현재 컨텍스트를 초기화(reset) 하고 싶은 경우가 생길 수 있습니다.

예를 들어:

* 응답 품질이 예상보다 떨어진다고 느껴질 때
* 하나의 작업을 마치고 새로운 작업을 시작하고자 할 때

이럴 경우, 현재 세션의 대화 이력(conversation history)과 컨텍스트(context)를 초기화함으로써 깨끗한 상태에서 시작할 수 있습니다.

#### ⚙️  컨텍스트 초기화 명령어:  `/clear` 

컨텍스트를 초기화하려면 다음 명령을 입력하세요:

```
/clear
```

🔍 예시 출력 :

```
Are you sure? This will erase the conversation history and context from hooks for the current session. [y/n]:
```

확인 후, 아래와 같이 y를 입력합니다:

```
y
```

🔍 예시 출력 :

```
Conversation history cleared.
```

#### 🧪 Task-16 실습

* Amazon Q CLI 세션의 > 프롬프트에서 다음을 입력하세요:

```
/clear
```

메시지가 나타나면 y로 확인:

```
Are you sure? This will erase the conversation history and context from hooks for the current session. [y/n]:
> y
```

다음 메시지가 출력되면 초기화 완료:

```
Conversation history cleared.
```

이제 세션이 완전히 초기화된 상태로 돌아가며, 컨텍스트에 저장되었던 대화 이력은 제거됩니다.

새로운 주제나 작업을 시작할 때 유용한 리셋 방법입니다.

***

## 🧩 Rules (규칙)

Amazon Q CLI를 더 자주 사용하게 되면, 반복적으로 동일한 지시를 입력해야 하는 상황이 자주 발생합니다. 예를 들어, 특정 작업을 수행할 때마다 항상 같은 코드 스타일, 보안 규칙, 아키텍처 원칙 등을 다시 알려줘야 한다면 이는 생산성을 저하시킬 뿐 아니라 일관성 있는 출력 결과를 해칠 위험도 있습니다.

Amazon Q CLI의 Rules(규칙) 기능은 이와 같은 반복 설정을 줄이고, 일관성 있고 예측 가능한 경험을 제공하기 위해 도입되었습니다.&#x20;

#### ⚙️ Rules의 역할

Rules(규칙)는 Amazon Q CLI에서 사용할 코딩 표준(coding standards)이나 모범사례(best practices)를 사전에 정의해두는 기능입니다. 이러한 규칙들은 Amazon Q CLI가 자동으로 컨텍스트(context)로 인식하여, 매번 지시하지 않아도 일관된 기준에 따라 작업을 수행하게 됩니다.

* 반복 설정 제거: 자주 반복되는 표준 지침을 명시해두면 매번 입력할 필요가 없습니다.
* 일관성 확보: 팀이나 개인이 선호하는 코드 스타일, 보안 정책 등을 항상 지켜줍니다.
* 작업 효율 향상: 규칙이 자동으로 컨텍스트에 포함되므로 빠르게 작업을 시작할 수 있습니다.

> 즉, Rules를 정의해두면, AI 도우미에게 매번 똑같은 기준을 설명하지 않아도, 한 번만 설정하면 모든 프롬프트에 자동으로 적용됩니다.

#### ⚙️  Rules 정의 방법

* Markdown(.md) 형식으로 작성합니다.
* 프로젝트 워크스페이스(workspace) 내에 저장합니다.
* 기본적으로 Amazon Q CLI는 다음 경로의 파일을 자동으로 로드합니다:

```
.amazonq/rules/**/*.md
```

```
/context show
```

🔍 예시 출력 :

```
> /context show

👤 Agent (q_cli_default):
    AmazonQ.md
    AGENTS.md
    README.md
    .amazonq/rules/**/*.md

💬 Session (temporary):
    <none>

No files in the current directory matched the rules above.
```

위 출력에서 볼 수 있듯이, Amazon Q CLI는 `.amazonq/rules/**/*.md` 경로의 마크다운 파일들을 자동으로 검색 및 적용합니다. &#x20;

#### ⚙️  Rules 파일 공유

프로젝트 디렉터리 내 .amazonq/rules 폴더에 규칙 파일을 저장하면,이 프로젝트를 다른 개발자가 클론(clone)하거나 체크아웃(checkout) 했을 때에도 동일한 규칙이 자동 적용됩니다.

따라서, 팀 단위 개발 시 일관된 코드 스타일, 보안 정책 등을 강제하거나 권장할 수 있습니다.

#### ⚙️  Rules vs Context 비교

둘은 모두 Amazon Q CLI가 참조하는 정보이지만, 역할은 다릅니다:

<table data-header-hidden><thead><tr><th width="167.89056396484375"></th><th></th></tr></thead><tbody><tr><td>구분</td><td>설명</td></tr><tr><td>Rules (규칙)</td><td><p>모든 프롬프트에 항상 유지되어야 할 기준이나 코딩 원칙 등.  </p><p>세션 전반에 걸쳐 지속적으로 적용됨</p></td></tr><tr><td>Context (컨텍스트)</td><td><p>특정 작업에 따라 유동적으로 추가/제거하는 리소스.  </p><p>예: 현재 작업에 필요한 README.md, AmazonQ.md 등</p></td></tr></tbody></table>

⚙️  요약:

* Rules = 항상 적용되어야 하는 지침
* Context = 작업에 따라 선택적으로 적용하는 자료

***

## 🧩 명령어 실행

Amazon Q CLI를 채팅 모드(chat mode)로만 사용하며, 프롬프트를 입력하고 응답을 받아왔습니다.

그러나 때때로 채팅 세션 중간에 터미널 명령어를 직접 실행하고 싶을 때가 있습니다.

물론 세션을 종료하고 명령어를 실행한 뒤 다시 시작할 수도 있지만, 그렇게 하면 지금까지의 대화 맥락(Context)과 히스토리(history) 가 사라지게 됩니다.

Amazon Q CLI는 이를 위한 특별한 방법을 제공합니다.

명령어 앞에 느낌표 `!` 를 붙이면, 해당 명령어가 현재 채팅 세션 내에서 실행되고 그 결과가 채팅창에 출력됩니다.

#### ⚙️ 명령어 실행 방법:&#x20;

```
! ls -altr
```

이 명령은 현재 디렉토리의 파일 목록을 `ls -altr` 형식으로 출력해줍니다.

#### ⚠️ 주의할 점 2가지

* 각 명령은 Stateless(비상태적)입니다.&#x20;

예를 들어 다음처럼 사용하면:

```
>! cd ~
>! ls
```

cd 명령은 기억되지 않기 때문에, ls는 여전히 원래 디렉토리의 내용을 출력합니다.

⚙️ 따라서, 반드시 명령어를 연결(concatenate) 해서 실행해야 합니다:

```
! cd ~ && ls
```

* 출력 내용은 컨텍스트를 소비합니다

출력 결과는 Amazon Q CLI의 context window(최대 200,000 tokens)에 포함되므로, 출력이 많을수록 더 많은 토큰을 소모합니다.

***

### 🧪 Task-17 실습

* Amazon Q CLI 실행

다음 명령어 입력:

```
! ls -altr
```

```
! whoami
! pwd
! uname -a
```

***

## 🧩 Managing Conversations (대화 저장 및 불러오기)

긴 세션 중간에 중단하고 나중에 이어서 작업해야 할 수도 있습니다.

이때는 다음과 같은 방법으로 대화 히스토리를 저장하고 재개할 수 있습니다.

#### ⚙️ 방법 1: `--resume`&#x20;

* 옵션으로 세션 재개

현재 디렉토리를 기준으로 마지막 대화 상태를 기억하여 복구합니다.

```
q chat --resume
```

실행 시 다음과 같은 메시지가 표시됩니다:

```
 $ q chat --resume
Picking up where we left off...

╭─────────────────────────────── Did you know? ────────────────────────────────╮
│                                                                              │
│        You can enable custom tools with MCP servers. Learn more with         │
│                                    /help                                     │
│                                                                              │
╰──────────────────────────────────────────────────────────────────────────────╯

/help all commands  •  ctrl + j new lines  •  ctrl + s fuzzy search
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🤖 You are chatting with claude-sonnet-4


> We reviewed two empty documentation files (AmazonQ.md and README.md), discussed improvement suggestions, then I explained Python's FastAPI framework.
```

이처럼 Amazon Q CLI는 현재 디렉터리별로 대화 상태를 기억하며, `--resume` 옵션을 통해 언제든지 중단한 작업을 이어서 재개할 수 있습니다.

#### ⚙️ 방법 2: 수동 저장 및 불러오기 — /save  & /load

작업을 하다 보면 현재의 대화 내용을 저장하고 나중에 복원하고 싶을 때가 있습니다.

특히 장시간 작업한 세션이라면, 나중에 복기하거나 공유하기 위해 저장해두면 유용합니다.

**저장:**

```
/save session-checkpoint
```

위 명령을 실행하면, 현재 디렉터리에 JSON 형식의 대화 기록 파일이 저장됩니다.

🔍 예시 출력 :

```
✔ Exported conversation state to session-checkpoint
```

**불러오기:**

```
/load session-checkpoint
```

저장된 대화를 복원하고, 이전 세션 그대로 이어서 대화를 진행할 수 있습니다.

***

### 🧪 Task-18 실습

* 새 Amazon Q CLI 세션 시작

다음 프롬프트 입력 (또는 자유롭게 입력):

```
고객 지원(Customer Service)애플리케이션을 설계하고 싶습니다.
설계 시 가장 중요하게 고려해야 할 상위 3가지 요소를 알려줄 수 있나요?
고객 지원(Customer Service) 애플리케이션에는 어떤 형태의 데이터 모델(Data Model)이 필요할까요?
코드는 생성하지 말고, 모델 구조만 보여줘.
```

대화를 저장:

```
/save session-checkpoint
```

새 터미널에서 저장된 파일을 확인 (옵션)

```
cat session-checkpoint
```

* 기존 Amazon Q CLI 세션 종료 후 새로 시작

대화 복원:

```
/load session-checkpoint
```

이어서 질문:

```
데이터 모델(Data Model) 내에서 티켓 구조에 대해 좀 더 자세히 설명해줄 수 있나요?
```

Amazon Q CLI가 이전 대화를 기억하고 자연스럽게 이어서 응답하는 것을 확인할 수 있어야 합니다.

🔍 예시 출력 :

```
> 데이터 모델(Data Model) 내에서 티켓 구조에 대해 좀 더 자세히 설명해줄 수 있나요?

> ## 티켓(Ticket) 구조 상세 설계

### 기본 속성
Ticket
├── id (Primary Key)
├── ticket_number (고유 식별번호, 예: CS-2024-001234)
├── title (제목)
├── description (상세 내용)
├── created_at, updated_at
└── resolved_at


### 분류 및 우선순위
├── priority (긴급도)
│   ├── LOW, MEDIUM, HIGH, CRITICAL
├── severity (심각도)
│   ├── MINOR, MAJOR, CRITICAL, BLOCKER
├── category (카테고리)
│   ├── TECHNICAL, BILLING, GENERAL, COMPLAINT
└── subcategory (하위 카테고리)


### 상태 관리
├── status (상태)
│   ├── NEW → ASSIGNED → IN_PROGRESS
│   ├── PENDING_CUSTOMER → RESOLVED → CLOSED
│   └── ESCALATED, REOPENED
├── status_history (상태 변경 이력)
└── sla_deadline (SLA 마감시한)


### 관계 및 할당
├── customer_id → Customer
├── assigned_to → Agent
├── created_by → User
├── escalated_to → Senior Agent/Manager
└── related_tickets (연관 티켓들)


### 추가 메타데이터
├── source (접수 경로)
│   ├── EMAIL, CHAT, PHONE, WEB_FORM
├── tags (태그 배열)
├── satisfaction_rating (만족도 평가)
├── resolution_summary (해결 요약)
└── internal_notes (내부 메모)


이 구조는 티켓의 전체 생명주기를 추적하고, SLA 관리, 성과 분석, 자동 라우팅을 지원합니다.
```

