---
description: 'update : 2025.07.22'
---

# 14. CloudWatch 기반 분석

## 🧩 CloudWatch MCP (Model Context Protocol) 기반 분석

### 🧪 LAB 개요

이 랩에서는 Amazon Q CLI와 CloudWatch MCP 서버를 활용하여 운영 환경의 상태를 분석하고, 실시간 모니터링, 로그 분석, 알람 확인 및 비용 최적화까지 수행하는 과정을 실습합니다.



✅ 목표: AI 기반 분석을 통한 CloudWatch 활용 자동화 이해 및 실무 적용 능력 강화

***

### 🧪 시나리오 1: 메트릭 기반 성능 진단

#### ✅ 실습 목표

EC2 인스턴스의 CPU 및 메모리 메트릭을 조회하고, 성능 저하 원인을 분석합니다.

💬 프롬프트 예시:

```
DMZVPC-Private-A-10.11.20.101 인스턴스의 최근 1시간 CPU 사용률을 조회하고, 
현재 계정의 모든 EC2 인스턴스를 포함한 시각적으로 개선된 CloudWatch 대시보드를 생성하고,
CloudWatch MCP 서버를 활용하여 더 효율적으로 작업해줘.

```

출력결과 예시: Cloudwatch 대시보드

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

```
## 주의사항 및 베스트 프랙티스

### 🔒 보안 고려사항
1. IAM 권한 최소화: CloudWatch 읽기 권한만 부여
2. VPC 보안: 프라이빗 서브넷 인스턴스 접근 제한
3. 모니터링 데이터 암호화: CloudWatch Logs 암호화 활성화

### 💰 비용 최적화
1. 메트릭 보존 기간: 불필요한 장기 보존 방지
2. 상세 모니터링: 필요한 인스턴스만 활성화
3. 알람 최적화: 중복 알람 제거

### 📈 성능 최적화
1. 대시보드 로딩: 위젯 수 제한 (20개 이하 권장)
2. 메트릭 집계: 적절한 Period 설정 (300초 권장)
3. 자동 새로고침: 5분 간격 설정

## 다음 단계

1. 알람 설정: CPU 사용률 80% 이상 시 SNS 알림
2. 로그 통합: CloudWatch Logs와 메트릭 연동
3. 자동화: Lambda를 통한 대시보드 자동 업데이트
4. 비용 모니터링: AWS Cost Explorer 연동
5. 커스텀 메트릭: 애플리케이션별 메트릭 추가

✅ 대시보드가 성공적으로 생성되었습니다! 
AWS 콘솔에서 "EC2-Comprehensive-Monitoring" 대시보드를 확인하실 수 있습니다.
```

#### 🔍 기대 응답

* MCP 도구 사용: get\_metric\_data
* 시각화된 CPU 사용률 및 분석 요약
* 비용 최적화를 위한 인스턴스 리사이징 제안

***

### 🧪 시나리오 2: 로그 기반 이상 탐지

#### ✅ 실습 목표 CloudWatch Logs Insight를 활용하여 시스템 로그에서 에러 및 패턴을 자동 분석합니다.

💬 프롬프트 예시:

```
/aws/ec2/system-logs 로그 그룹에서 최근 2시간 동안 ERROR가 포함된 로그를 찾아줘.
CloudWatch MCP 서버를 활용하여 더 효율적으로 작업해줘.
```

#### 🔍 기대 응답

* MCP 도구 사용: execute\_log\_insights\_query
* 시간대별 에러 수, 에러 유형 분포, 관련 리소스 식별
* 원인 패턴 분석 및 조치 제안

***

### 🧪 시나리오 3: 알람 현황 및 히스토리 분석

#### ✅ 실습 목표

활성 알람 목록 조회 및 특정 알람의 이력 분석

💬 프롬프트 예시:

```
현재 ALARM 상태인 모든 알람을 조회해줘
High-CPU-Usage 알람의 최근 24시간 히스토리를 분석해줘
```

#### 🔍 기대 응답

* 활성 알람 수 및 상태 정리
* 알람 발생 추이, 원인 변화 분석

***

### 🧪 시나리오 4: 종합 성능 점검

#### ✅ 실습 목표

지정된 인스턴스에 대해 메트릭 + 로그 + 알람 데이터를 종합 분석합니다.

💬 프롬프트 예시:

```
DMZVPC-Private-A-10.11.20.101에 대해서 다음을 분석해주세요:
1. 최근 4시간 동안의 CPU, 메모리, 네트워크, 디스크 사용률
2. 같은 시간대의 에러 로그 패턴
```

***

### 🧪 시나리오 5: 용량 계획 자동화

#### ✅ 실습 목표

최근 30일 데이터를 기반으로 EC2 용량 계획 수립합니다.

💬 프롬프트 예시:

```
다음 조건으로 용량 계획을 수립해주세요:
- 대상: ap-northeast-2 리전의 모든 EC2 인스턴스
- 기간: 최근 30일간 데이터
- 분석 항목: CPU, 메모리, 네트워크 사용률 트렌드
- 결과: 리소스 부족 예상 시점과 스케일링 권장사항
```

***

### 🧪 시나리오 6: 보안 로그 기반 이상 탐지

#### ✅ 실습 목표

#### CloudWatch 로그를 통한 로그인 실패 및 비정상 트래픽 분석합니다.

💬 프롬프트 예시:

```
보안 상태를 종합적으로 분석해주세요:
1. 최근 24시간 로그인 실패 시도 패턴
2. 권한 관련 에러 발생 현황
3. 비정상적인 네트워크 활동 탐지
4. 보안 점수 산정 및 개선 방안
```

***

### ✅ 종합 프롬프트 템플릿

💬 프롬프트 예시:

```
오늘의 시스템 상태를 점검해주세요:
- 시간 범위: 오늘 00:00 ~ 현재
- 점검 항목: 활성 알람, 주요 메트릭 이상치, 에러 로그
- 결과 형식: 요약 + 상세 분석 + 권장 조치사항
```

💬 프롬프트 예시:

```
[시간]에 발생한 장애를 분석해주세요:
1. 장애 시점 전후 30분간 모든 메트릭 변화
2. 관련 에러 로그와 패턴 분석
3. 알람 발생 순서와 연관성
4. 근본 원인과 재발 방지 방안
```

💬 프롬프트 예시:

```
[인스턴스 ID]의 성능을 벤치마킹해주세요:
- 비교 기준: 지난주 같은 시간대
- 메트릭: CPU, 메모리, 네트워크, 디스크 I/O
- 분석: 성능 변화 추이와 원인 분석
```

***

### 📘 참고 자료

* [Amazon CloudWatch 공식 문서](https://docs.aws.amazon.com/cloudwatch)
* [Amazon Q Developer CLI 가이드](https://docs.aws.amazon.com/q/developer/)
* [CloudWatch MCP GitHub 프로젝트](https://github.com/awslabs/cloudwatch-mcp-server)

***
